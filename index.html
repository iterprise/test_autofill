<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Auto-Fill Events</title>
</head>
<body>
    <form id="test-form">
        <input type="text" id="username" name="username" placeholder="Enter your username" autocomplete="username">
        <input type="password" id="password" name="password" placeholder="Enter your password" autocomplete="current-password">
        <button type="submit">Submit</button>
    </form>

    <script>
        const eventLog = [];

        // Функция для глубокого копирования объекта события
        function serialize(event) {
            const eventObject = {};
            const keys = Reflect.ownKeys(event);

            keys.forEach(key => {
                try {
                    eventObject[key] = event[key];
                } catch (e) {
                    eventObject[key] = `Error: ${e.message}`;
                }
            });

            let currentObj = event;
            while (currentObj) {
                const protoKeys = Reflect.ownKeys(currentObj);
                protoKeys.forEach(key => {
                    if (!(key in eventObject)) {
                        try {
                            eventObject[key] = currentObj[key];
                        } catch (e) {
                            eventObject[key] = `Error: ${e.message}`;
                        }
                    }
                });
                currentObj = Object.getPrototypeOf(currentObj);
            }

            return eventObject;
        }

        // Функция для логирования события
        function logEvent(event) {
            const logEntry = {
                type: event.type,
                value: event.target.value,
                isFocused: document.activeElement === event.target,
                timestamp: new Date().toISOString(),
                eventObject: serialize(event)
            };
            eventLog.push(logEntry);
            console.log(logEntry);
        }

        // Список всех возможных событий
        const events = [
            'change', 'input', 'focus', 'blur', 'keydown', 'keyup', 'keypress', 
            'click', 'dblclick', 'mousedown', 'mouseup', 'mouseover', 'mouseout', 
            'mouseenter', 'mouseleave', 'contextmenu', 'paste', 'copy', 'cut', 
            'select', 'compositionstart', 'compositionupdate', 'compositionend'
        ];

        // Выбор элементов input
        const inputElements = document.querySelectorAll('#username, #password');

        // Повесить обработчики на все события для каждого input
        inputElements.forEach(inputElement => {
            events.forEach(eventType => {
                inputElement.addEventListener(eventType, logEvent);
            });
        });

        // Обработка отправки формы для предложений браузера сохранить данные
        document.getElementById('test-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Предотвращение реального отправления формы для тестирования
            alert('Form submitted!');
        });

        // Вывод JSON массива со всей информацией через 2 секунды после загрузки страницы
        setTimeout(() => {
            console.log('Event log:', JSON.stringify(eventLog, null, 2));
        }, 2000);
    </script>
</body>
</html>
